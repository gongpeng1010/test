<!DOCTYPE html>
<html lang="zh-cn">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport"
    content="width=device-width,initial-scale=1.0,minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title></title>
  <meta name="keywords" content="" />
  <meta name="description" content="" />
  <meta name="author" content="order by sucaihuo.com" />
  <style>
    *{
      box-sizing: border-box;
    }
    body{
      margin: 0;
    }
    #myCanvas{
      background: #000;
      width:100%;
      height:100vh;
    }
    .alert{
      width:300px;
      height: 300px;
      position: absolute;
      z-index: 11;
      background: rgba(100,100,100,0.5);
      left:50%;
      top:50%;
      margin:-150px 0 0 -150px;
      text-align: center;
    }
    .none{
      display: none;
    }
    .text{
      color:#fff;
    }
    .hidden{
      position: fixed;
      left:-100000px;
    }
    .title{
      width: 300px;
      height: 200px;
      position: absolute;
      z-index: 100;
      left: 50%;
      top:20px;
      text-align: center;
      margin-left: -150px;
      background-image: -webkit-linear-gradient(left,blue,#66ffff 10%,#cc00ff 20%,#CC00CC 30%, #CCCCFF 40%, #00FFFF 50%,#CCCCFF 60%,#CC00CC 70%,#CC00FF 80%,#66FFFF 90%,blue 100%);
      -webkit-text-fill-color: transparent;/* 将字体设置成透明色 */
      -webkit-background-clip: text;/* 裁剪背景图，使文字作为裁剪区域向外裁剪 */
      -webkit-background-size: 200% 100%; 
      -webkit-animation: masked-animation 4s linear infinite;
      font-size: 35px;
      display: none;
  }
  @keyframes masked-animation {
      0% {
          background-position: 0  0;
      }
      100% {
          background-position: -100%  0;
      }
  }
  .overImg{
    width:100%;
    opacity: 0;
    position: absolute;
    left:0;
    top:0;
    z-index: 10;
    transition: all 2s;
  }
  </style>
  
</head>

<body >
    <!-- <div onclick='go()' style="position: absolute;z-index: 100;color:#fff">放</div> -->
    <div class="alert" id="alert1">
      <video width="300px" height="260px"></video>
      <!-- <canvas width="200px" height="150px"></canvas> -->
      <div>
          <button id="start">打开人脸识别</button>
          <!-- <button id="snap">截取图像</button>
          <button id="close">关闭摄像头</button> -->
      </div>
    </div>
    <div class="alert none" id="alert2">
      <img style="width: 300px;height:260px" src='https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fimg.bq233.com%2Fkanqq%2Fpic%2Fupload%2F2018%2F0606%2F1528254708392902.jpg&refer=http%3A%2F%2Fimg.bq233.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=jpeg?sec=1615190193&t=9041de680d652107bd04c1783a80828a'>
      <div class="text">解锁成功，相似度99.99%</div>
    </div>
    <canvas id='myCanvas'></canvas>
    <div class="title" id="title">新年快乐鸭！</div>
    <img class="overImg" id='overImg' src='https://th.bing.com/th/id/R0f3c19fefe13995f0229d72e4d8e34f0?rik=1KSYDMgHDsiHqw&riu=http%3a%2f%2fwww.qncye.com%2fbuttom%2fimages%2fhk02.jpg&ehk=tzEaEhFNSIl9cGGjNIwEsomAFxNdaPAM%2fvNkdJz59Ws%3d&risl=&pid=ImgRaw'>
</body>
  <script>
  //javascript:!(function() {var cdom = document.createElement("canvas");cdom.id = "myCanvas";cdom.style.position="fixed";cdom.style.left = "0";cdom.style.top = "0";cdom.style.zIndex=-1;document.body.appendChild(cdom);var canvas = document.getElementById('myCanvas');var context = canvas.getContext('2d');function resizeCanvas() {canvas.width = window.innerWidth;canvas.height = window.innerHeight;}window.addEventListener('resize', resizeCanvas, false);resizeCanvas();clearCanvas();function clearCanvas(){context.fillStyle = '#000000';context.fillRect(0,0,canvas.width, canvas.height);}function mouseDownHandler(e) {var x = e.clientX;var y = e.clientY;fire(x,y);}var rid;function fire(x,y){createFireworks(x,y);function tick() {context.globalCompositeOperation = 'destination-out';    context.fillStyle = 'rgba(0,0,0,'+10/100+')';    context.fillRect(0,0,canvas.width,canvas.height);    context.globalCompositeOperation = 'lighter';drawFireworks();rid=requestAnimationFrame(tick);}cancelAnimationFrame(rid);tick();}var particles=[];function createFireworks(sx,sy){particles=[];var hue = Math.floor(Math.random()*51)+150;var hueVariance = 30;var count = 100;for(var i = 0 ;i<count;i++){var p = {};var angle = Math.floor(Math.random()*360);p.radians = angle * Math.PI / 180;p.x = sx;p.y = sy;p.speed = (Math.random()*5)+.4;p.radius = p.speed;p.size = Math.floor(Math.random()*3)+1;p.hue = Math.floor(Math.random()*((hue+hueVariance)-(hue-hueVariance)))+(hue-hueVariance);p.brightness = Math.floor(Math.random()*31)+50;p.alpha = (Math.floor(Math.random()*61)+40)/100;particles.push(p);}}function drawFireworks() {clearCanvas();for(var i = 0 ;i<particles.length;i++){var p = particles[i];var vx = Math.cos(p.radians) * p.radius;var vy = Math.sin(p.radians) * p.radius + 0.4;p.x += vx;p.y += vy;p.radius *= 1 - p.speed/100;p.alpha -= 0.005;context.beginPath();context.arc(p.x, p.y, p.size, 0, Math.PI*2, false);context.closePath();context.fillStyle = 'hsla('+p.hue+', 100%, '+p.brightness+'%, '+p.alpha+')';context.fill();}}document.addEventListener('mousedown', mouseDownHandler, false);})();

      // var cdom = document.createElement("canvas");
      // cdom.id = "myCanvas";
      // cdom.style.position = "fixed";
      // cdom.style.left = "0";
      // cdom.style.top = "0";
      // cdom.style.zIndex = -1;
      //document.body.appendChild(cdom);
      var canvas = document.getElementById('myCanvas');
      var context = canvas.getContext('2d');
      function resizeCanvas() {
          canvas.width = window.innerWidth;
          canvas.height = window.innerHeight;
      }
      window.addEventListener('resize', resizeCanvas, false);
      resizeCanvas();
      clearCanvas();
      function clearCanvas() {
        return ;
          context.fillStyle = '#000000';
          context.fillRect(0, 0, canvas.width, canvas.height);
      }
      function mouseDownHandler(e) {
          // var x = e.clientX;
          // var y = e.clientY;
          var w=document.body.clientWidth
          var h=document.body.clientHeight
          var x=Math.floor(Math.random() * (w - 100)) + (100)
          var y=Math.floor(Math.random() * (h - 100)) + (100)
 
          fire(x, y);
      }
      var rid;
      function fire(x, y) {
          createFireworks(x, y);
          function tick() {
            var canvas = document.getElementById('myCanvas');
            var context = canvas.getContext('2d');
              context.globalCompositeOperation = 'destination-out';
              context.fillStyle = 'rgba(0,0,0,' + 10 / 100 + ')';
              context.fillRect(0, 0, canvas.width, canvas.height);
              context.globalCompositeOperation = 'lighter';
              drawFireworks(context);
              rid = requestAnimationFrame(tick);
          }
          cancelAnimationFrame(rid);
          tick();
      }
      var particles = [];
      function createFireworks(sx, sy) {
          particles = [];
          var hue = Math.floor(Math.random() * 51) + 150;
          var hueVariance = 30;
          var count = 100;
          for (var i = 0; i < count; i++) {
              var p = {};
              var angle = Math.floor(Math.random() * 360);
              p.radians = angle * Math.PI / 180;
              p.x = sx;
              p.y = sy;
              p.speed = (Math.random() * 5) + .4;
              p.radius = p.speed;
              p.size = Math.floor(Math.random() * 3) + 1;
              p.hue = Math.floor(Math.random() * ((360) - (200))) + (200);
              p.brightness = Math.floor(Math.random() * 31) + 50;
              p.alpha = (Math.floor(Math.random() * 61) + 40) / 100;
              particles.push(p);
          }
      }
      function drawFireworks(context) {
          clearCanvas();
          for (var i = 0; i < particles.length; i++) {
              var p = particles[i];
              var vx = Math.cos(p.radians) * p.radius;
              var vy = Math.sin(p.radians) * p.radius + 0.4;
              p.x += vx;
              p.y += vy;
              p.radius *= 1 - p.speed / 100;
              p.alpha -= 0.009;
              context.beginPath();
              context.arc(p.x, p.y, p.size, 0, Math.PI * 2, false);
              context.closePath();
              context.fillStyle = 'hsla(' + p.hue + ', 100%, ' + p.brightness + '%, ' + p.alpha + ')';
              context.fill();
          }
      }
      

  let cont=0;
  function go(){
    if(cont>15){
      overImg.style.opacity='1'
      title.style.display='none'
      return ;
    }
    if(cont>2){
      title.style.display='block'
    }
    setTimeout(function(){
      cont+=1
      mouseDownHandler()
      go()
    },1000)

  }
 //document.addEventListener('mousedown', mouseDownHandler, false);

 var canvas = document.getElementsByTagName('canvas')[0],
               context =''// canvas.getContext('2d'),
               video = document.getElementsByTagName("video")[0],
               snap =''// document.getElementById("snap"),
               //close1 = document.getElementById("close1"),
               start = document.getElementById("start"),
               MediaStreamTrack;
           start.addEventListener('click', function () {
               if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                   navigator.mediaDevices.getUserMedia({
                       video: true,
           
                   }).then(function (stream) {
                       console.log(stream);
                       MediaStreamTrack=typeof stream.stop==='function'?stream:stream.getTracks();
                       //video.src=(window.URL).createObjectURL(stream);
                       try {
                         video.srcObject = stream;
                        }catch(error) {
                          video.src = window.URL.createObjectURL(stream);
                        }
                       video.play();
                       setTimeout(function(){
                          videoSuccess()
                        },2800)
                   }).catch(function(err){
                       console.log(err);
                       if(err.toString().indexOf('Permission denied')!=-1){
                         alert('再次拒绝会引起电脑爆炸💥');
                        return ;
                       }
                   });
               }else if(navigator.getMedia){
                   navigator.getMedia({
                       video: true
                   }).then(function (stream) {
                       console.log(stream);
                       MediaStreamTrack=stream.getTracks();
                       //video.src=(window.webkitURL).createObjectURL(stream);

                       try {
                         video.srcObject = stream;
                        }catch(error) {
                          video.src = window.webkitURL.createObjectURL(stream);
                        }

                       video.play();
                       setTimeout(function(){
                          videoSuccess()
                        },2000)
                       
                   }).catch(function(err){
                       console.log(err);
                       if(err.toString().indexOf('Permission denied')!=-1){
                         alert('再次拒绝会引起电脑爆炸💥');
                        return ;
                       }
                   });
               }
           });
          //  snap.addEventListener('click', function () {
          //      context.drawImage(video, 0, 0,200,150);
          //  });
          //  close1.addEventListener('click', function () {
          //    console.log(MediaStreamTrack)
          //     // MediaStreamTrack && MediaStreamTrack.stop();
          //      MediaStreamTrack[0].stop();
          //      MediaStreamTrack[1].stop();
          //  });
           function videoSuccess(){
            alert1.style.display='none'
            alert2.style.display='block'
            try{
              MediaStreamTrack[0].stop();
              MediaStreamTrack[1].stop();
            }catch(e){}
            
            setTimeout(function(){
              alert2.style.display='none'
              go()
            },1900)
           }
           
  </script>
</html>